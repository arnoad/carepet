<div class="requests-box">
  <h1><%= @carer.full_name %>'s profile</h1>
  <div class="profile-card">
    <div class="profile-avatar-info">
      <div>
        <%= cl_image_tag @carer.photo.key, class: "avatar-profile" %>
      </div>
      <div>
        <div class="profile-avatar-info-title">
          <p><i class="fa-solid fa-user"></i> <%= @carer.full_name %>, <%= @carer.age %></p>
        </div>
        <div class="profile-avatar-info-text">
          <p><i class="fa-solid fa-location-dot"></i> <%= @carer.address %></p>
          <p><i class="fa-solid fa-house"></i> <%= @carer.house_type %></p>
          <p><i class="fa-solid fa-star"></i>
            <% avg_sum = 0 %>
            <% avg_sum %>
            <% @reviews.size %>
              <% @reviews.each do |review| %>
              <% avg_sum += review.rating %>
              <% end %>
            <% avg_sum %>
              <% if @reviews.count > 0 %>
              <% avg_rating = avg_sum / @reviews.count %>
              <%= avg_rating.round(2) %>
              <% else %>
              <p>This carer has no ratings yet.</p>
              <% end %>
          </p>
        </div>
      </div>
    </div>
    <div class="bio">
      <p><%= @carer.bio %></p>
    </div>
  </div>
  <div class="profile-buttons">
    <%= link_to 'BOOK THIS CARER', new_carer_request_path(@carer), class: "btn-one" %>
    <%= link_to 'BACK TO SEARCH', carers_path, class: "btn-two" %>
  </div>
  <br>
  <p><strong>Reviews</strong></p>
    <% if @reviews.empty? %>
      <p>This carer has no reviews yet.</p>
    <% else %>
      <% @reviews.each do |review| %>

      <div class="profile-card">
        <div class="profile-avatar-info">
          <%= cl_image_tag review.user.photo.key, class: "avatar-reviews" %>
          <div class="reviews-avatar-info-title">
          <p><strong><%= review.user.full_name %></strong></p>
          <p class="reviews-avatar-date"><%= review.created_at.strftime("%d/%m/%Y at %H:%M") %></p>
          </div>
          <div>
          <%= link_to review_path(review), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this review?" }, class: 'btn btn-danger btn-sm justify-content-end', style: 'background-color: transparent; border: none; color: black;' do %>
          <i class="fa-solid fa-trash-can justify-content-end"></i>
          <% end %>
        </div>
        </div>
        <div id="profile-avatar-info-text">
          <p><%= review.content %></p>
          <div style="display: flex; justify-content: flex-end;">
          <p><i class="fa-solid fa-star"></i> <%= review.rating %></p>
          </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
